<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Gemini 2.5 Pro">
<meta name="dcterms.date" content="2025-10-24">

<title>Team Topologies – VZ’s LogBook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-f3e87e0bb0765aae0ce4da68b988dce5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../custom.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">VZ’s LogBook</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">ABOUT</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../now.html"> 
<span class="menu-text">NOW</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../talks/"> 
<span class="menu-text">TALKS</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-notes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">NOTES</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-notes">    
        <li>
    <a class="dropdown-item" href="../../notes/books/">
 <span class="dropdown-text">Books</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../notes/bots/">
 <span class="dropdown-text">Bots</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../notes/edu/">
 <span class="dropdown-text">Education</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../notes/pub/">
 <span class="dropdown-text">Published</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../notes/tech/">
 <span class="dropdown-text">Tech</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/vanzaj/vz-logbook.git">
 <span class="dropdown-text">Source Code</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#p-please-give-me-a-summary-of-team-topologies-organizing-business-and-technology-teams-for-fast-flow-book-by-manuel-pais-and-matthew-skelton." id="toc-p-please-give-me-a-summary-of-team-topologies-organizing-business-and-technology-teams-for-fast-flow-book-by-manuel-pais-and-matthew-skelton." class="nav-link active" data-scroll-target="#p-please-give-me-a-summary-of-team-topologies-organizing-business-and-technology-teams-for-fast-flow-book-by-manuel-pais-and-matthew-skelton.">P: Please give me a summary of Team Topologies: Organizing Business and Technology Teams for Fast Flow Book by Manuel Pais and Matthew Skelton.</a></li>
  <li><a href="#p-how-is-team-cognitive-load-defined-in-the-book" id="toc-p-how-is-team-cognitive-load-defined-in-the-book" class="nav-link" data-scroll-target="#p-how-is-team-cognitive-load-defined-in-the-book">P: How is ‘team cognitive load’ defined in the book?</a></li>
  <li><a href="#my-thoughts" id="toc-my-thoughts" class="nav-link" data-scroll-target="#my-thoughts">My thoughts</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Team Topologies</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Gemini 2.5 Pro </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 24, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p><em>Team Topologies</em> by Matthew Skelton and Manuel Pais is a pretty popular book. 4.18 stars from 5374 ratings on <a href="https://www.goodreads.com/book/show/44135420-team-topologies">goodread.com</a> and similar ranking on Amazon.</p>
<p>I haven’t read it, but today I have decided to learn a bit more about it using Gemini 2.5 Pro.</p>
<hr>
<section id="p-please-give-me-a-summary-of-team-topologies-organizing-business-and-technology-teams-for-fast-flow-book-by-manuel-pais-and-matthew-skelton." class="level2">
<h2 class="anchored" data-anchor-id="p-please-give-me-a-summary-of-team-topologies-organizing-business-and-technology-teams-for-fast-flow-book-by-manuel-pais-and-matthew-skelton.">P: Please give me a summary of Team Topologies: Organizing Business and Technology Teams for Fast Flow Book by Manuel Pais and Matthew Skelton.</h2>
<p>Here’s a summary of the book <em>Team Topologies: Organizing Business and Technology Teams for Fast Flow</em> by Manuel Pais and Matthew Skelton.</p>
<p>The book provides a practical and adaptive model for organizing technology and business teams. Its primary goal is to help organizations achieve a fast flow of software delivery by optimizing team structures to reduce dependencies, improve communication, and, most importantly, manage <strong>team cognitive load</strong>.</p>
<section id="the-core-problem-cognitive-load" class="level4">
<h4 class="anchored" data-anchor-id="the-core-problem-cognitive-load">The Core Problem: Cognitive Load</h4>
<p>The central concept of the book is <strong>Team Cognitive Load</strong>. This refers to the total amount of mental effort a team is using at any given time. The authors, drawing on psychologist John Sweller’s work, argue that a team, like an individual, has a finite cognitive capacity.</p>
<p>If a team is responsible for too many different things (e.g., multiple complex business domains, intricate infrastructure, testing, operations, and user support), its cognitive load becomes too high. This overload is the main blocker to a fast flow of value, leading to:</p>
<ul>
<li>Slow delivery</li>
<li>Poor-quality work</li>
<li>Team burnout</li>
<li>An inability to innovate</li>
</ul>
<p>The entire <em>Team Topologies</em> model is designed to explicitly limit and manage the cognitive load of each team.</p>
</section>
<section id="the-four-fundamental-team-topologies" class="level4">
<h4 class="anchored" data-anchor-id="the-four-fundamental-team-topologies">The Four Fundamental Team Topologies</h4>
<p>The book proposes that instead of functional silos (like “dev,” “ops,” “QA”), organizations should use only four fundamental types of teams.</p>
<ol type="1">
<li><p><strong>Stream-aligned Team</strong>: This is the primary team type. It’s a cross-functional team aligned to a single, valuable “stream” of work, such as a product, a service, a user journey, or a specific business capability. They are empowered to build, run, and own their service end-to-end, from idea to production and back. The majority of teams in an organization should be stream-aligned.</p></li>
<li><p><strong>Platform Team</strong>: The purpose of a platform team is to enable stream-aligned teams to deliver their work with more autonomy and less effort. They provide internal services and tools (e.g., CI/CD pipelines, monitoring dashboards, self-service infrastructure) as an internal “product.” This reduces the cognitive load on stream-aligned teams, as they don’t have to be experts in (for example) Kubernetes orchestration.</p></li>
<li><p><strong>Enabling Team</strong>: This is a team of specialists (e.g., in security, test automation, or a new technology) who help stream-aligned teams acquire missing capabilities. Their goal is not to do the work for other teams but to “teach them how to fish.” They are temporary and move on once the stream-aligned team is self-sufficient in that area.</p></li>
<li><p><strong>Complicated-subsystem Team</strong>: This team is only created when a specific part of the system is so complex that it requires deep, specialized knowledge (e.g., a real-time video processing engine, a complex financial-modeling algorithm). This team builds and maintains that one subsystem, hiding its complexity from other teams (usually platform or stream-aligned) who consume it as a service.</p></li>
</ol>
</section>
<section id="the-three-team-interaction-modes" class="level4">
<h4 class="anchored" data-anchor-id="the-three-team-interaction-modes">The Three Team Interaction Modes</h4>
<p>The book also defines three specific ways these teams should interact. Using these explicit modes makes communication and dependencies clear, avoiding messy, undefined “coordination.”</p>
<ol type="1">
<li><p><strong>Collaboration</strong>: Two teams work closely together for a defined, temporary period. This mode is used for rapid discovery and innovation, such as when a stream-aligned team and a platform team are figuring out a new API. It is high-bandwidth but creates a high cognitive load, so it should be used sparingly and with a clear goal.</p></li>
<li><p><strong>X-as-a-Service</strong>: This is the most common and desirable mode. One team consumes a service, tool, or API from another (like a platform team) with minimal interaction. This mode works best when the service is reliable, well-documented, and easy to use, as it minimizes the cognitive load on the consuming team.</p></li>
<li><p><strong>Facilitating</strong>: One team (usually an enabling team) helps and mentors another team to clear an obstacle or learn a new skill. The goal is to grow the capabilities of the team being facilitated. This is a temporary interaction.</p></li>
</ol>
</section>
<section id="key-principles-and-goals" class="level4">
<h4 class="anchored" data-anchor-id="key-principles-and-goals">Key Principles and Goals</h4>
<ul>
<li><p><strong>Fast Flow</strong>: The ultimate goal is to optimize the organization for a fast, smooth flow of change into production. The topologies and interaction modes are all in service of this goal.</p></li>
<li><p><strong>Reverse Conway’s Law</strong>: The book heavily references <a href="https://en.wikipedia.org/wiki/Conway%27s_law">Conway’s Law</a>, which states that organizations design systems that mirror their own communication structures. <em>Team Topologies</em> advises organizations to use this as a tool: “First, design the organization you want, and the system architecture will follow.” By creating small, autonomous, stream-aligned teams, you are intentionally designing your organization to produce a loosely coupled, modular software architecture.</p></li>
<li><p><strong>Team-First Approach</strong>: The team is the fundamental unit of delivery. The model emphasizes creating long-lived, stable teams and giving them the autonomy and cognitive space to own their work and “build the right thing” and “build the thing right.”</p></li>
</ul>
<hr>
</section>
</section>
<section id="p-how-is-team-cognitive-load-defined-in-the-book" class="level2">
<h2 class="anchored" data-anchor-id="p-how-is-team-cognitive-load-defined-in-the-book">P: How is ‘team cognitive load’ defined in the book?</h2>
<p>In Team Topologies, ‘team cognitive load’ is defined as the total <strong>mental effort and capacity</strong> being used by a team at any given time to get their work done.</p>
<p>The authors, Manuel Pais and Matthew Skelton, adapt this concept from psychologist John Sweller’s Cognitive Load Theory. They argue that a team, just like an individual, has a finite mental capacity. If a team is responsible for too much, their performance plummets.</p>
<p>The book breaks this load down into three specific types:</p>
<ul>
<li><p><strong>Intrinsic Cognitive Load</strong>: The “good” or necessary complexity related to the team’s core domain. For example, the effort required to understand the specific business rules of a payment processing system.</p></li>
<li><p><strong>Extraneous Cognitive Load</strong>: The “bad” or wasteful complexity. This is the mental effort spent on non-value-adding tasks, such as fighting with deployment tools, navigating complex environments, or trying to understand another team’s confusing API.</p></li>
<li><p><strong>Germane Cognitive Load</strong>: The “value-adding” complexity. This is the effort dedicated to learning, improving, and innovating within the core domain, such as discovering better ways to solve a business problem or improving the system’s architecture.</p></li>
</ul>
<p>The central goal of the Team Topologies model is to <strong>minimize extraneous cognitive load</strong> (by using things like Platform teams) and keep the intrinsic load manageable. This frees up the team’s mental capacity for the <strong>germane load</strong>, which is where true innovation and “fast flow” happen.</p>
<hr>
</section>
<section id="my-thoughts" class="level2">
<h2 class="anchored" data-anchor-id="my-thoughts">My thoughts</h2>
<p>So, “team topologies” are basically advocating for <em>component teams</em>, teams that are narrowly specialized in either business (value-streams) or technology domains, and effort must be made to ensure they are as independent as possible, as few dependencies as possible; i.e teams work in isolation. They recognize the value of cross-functionality within the team, but reject the same idea for several teams working in the same product area.</p>
<p>If I were a business owner, I wish all my dev teams could pick up and do <em>any</em> kind of work. If they don’t know how, they can learn. And I am happy to pay for their “learning time”.</p>


</section>

</main> <!-- /main -->
<script data-goatcounter="https://vanzaj.goatcounter.com/count" async="" src="//gc.zgo.at/count.js"></script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/sansans\.net");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><img src="../../assets/cc-by-nc-sa.png" alt="CC BY-NC-SA" style="height: 31px;"></a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>